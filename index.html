<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ QR</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- QR Scanner -->
<script src="https://unpkg.com/html5-qrcode"></script>

<!-- QR Generator -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
body{font-family:sans-serif;background:#f4f6f8;padding:10px}
.card{background:#fff;padding:15px;margin:10px auto;max-width:420px;border-radius:10px}
input,select,button{width:100%;padding:8px;margin:5px 0}
button{background:#0066ff;color:#fff;border:none;border-radius:6px}
.hidden{display:none}
.idcard{border:2px solid #000;padding:10px;text-align:center}
</style>
</head>
<body>

<h2 align="center">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ QR</h2>

<select onchange="show(this.value)">
<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</option>
<option value="student">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
<option value="teacher">‡∏Ñ‡∏£‡∏π</option>
<option value="admin">‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</option>
</select>

<!-- ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
<div id="student" class="card hidden">
<h3>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
<input id="sid" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
<button onclick="viewStudent()">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
<div id="sdata"></div>
</div>

<!-- ‡∏Ñ‡∏£‡∏π -->
<div id="teacher" class="card hidden">
<h3>‡∏Ñ‡∏£‡∏π</h3>
<button onclick="startScan()">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô QR</button>
<select id="status">
<option>‡∏°‡∏≤</option>
<option>‡∏°‡∏≤‡∏™‡∏≤‡∏¢</option>
<option>‡∏Ç‡∏≤‡∏î</option>
<option>‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
<option>‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
</select>
<div id="reader"></div>
</div>

<!-- ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô -->
<div id="admin" class="card hidden">
<h3>‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h3>
<input id="apass" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô">
<button onclick="loginAdmin()">‡πÄ‡∏Ç‡πâ‡∏≤</button>

<div id="apanel" class="hidden">
<hr>
<input id="nsid" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
<input id="nsname" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
<button onclick="addStudent()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>

<div class="idcard">
<h4 id="cname"></h4>
<div id="qrcode"></div>
</div>
</div>
</div>

<script>
/* üî¥ ‡πÉ‡∏™‡πà firebaseConfig ‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡∏¢‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* UI */
function show(id){
["student","teacher","admin"].forEach(e=>document.getElementById(e).classList.add("hidden"))
if(id) document.getElementById(id).classList.remove("hidden")
}

/* Admin */
function loginAdmin(){
if(apass.value!="1669") return alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î");
apanel.classList.remove("hidden")
}

async function addStudent(){
await db.collection("students").doc(nsid.value).set({
name:nsname.value,
log:[]
});
document.getElementById("cname").innerText = nsname.value;
document.getElementById("qrcode").innerHTML="";
new QRCode("qrcode", nsid.value);
alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô + ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏•‡πâ‡∏ß");
}

/* Student */
async function viewStudent(){
const doc = await db.collection("students").doc(sid.value).get();
if(!doc.exists) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
let d = doc.data();
sdata.innerHTML = "<b>"+d.name+"</b><br>"+d.log.map(l=>`${l.date} : ${l.status}`).join("<br>");
}

/* Teacher QR Scan */
function startScan(){
const qr = new Html5Qrcode("reader");
qr.start({ facingMode: "environment" },{}, async (text)=>{
let ref = db.collection("students").doc(text);
let doc = await ref.get();
if(!doc.exists){alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");return}
let data = doc.data();
data.log.push({
date:new Date().toLocaleString(),
status:status.value
});
await ref.update({log:data.log});
alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß");
qr.stop();
});
}
</script>

</body>
</html>
