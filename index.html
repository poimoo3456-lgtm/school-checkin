<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ QR</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<style>
body{font-family:sans-serif;background:#f4f6f8;padding:20px}
.box{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
button{padding:6px 12px;margin:5px}
input,select{padding:5px;margin:5px}
.hidden{display:none}
</style>
</head>
<body>

<h2 id="schoolName">üè´ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</h2>
<img id="schoolLogo" src="" height="60">

<div class="box">
<button onclick="show('student')">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
<button onclick="show('teacher')">‡∏Ñ‡∏£‡∏π</button>
<button onclick="show('admin')">‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</button>
</div>

<!-- ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
<div id="student" class="box hidden">
<h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
<input id="stuId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
<button onclick="studentLogin()">‡πÄ‡∏Ç‡πâ‡∏≤</button>
<div id="stuArea"></div>
</div>

<!-- ‡∏Ñ‡∏£‡∏π -->
<div id="teacher" class="box hidden">
<h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏π</h3>
<input id="tUser" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π">
<input id="tPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
<button onclick="teacherLogin()">‡πÄ‡∏Ç‡πâ‡∏≤</button>
<div id="teacherArea"></div>
</div>

<!-- Admin -->
<div id="admin" class="box hidden">
<h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h3>
<input id="adminPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
<button onclick="adminLogin()">‡πÄ‡∏Ç‡πâ‡∏≤</button>
<div id="adminArea"></div>
</div>

<script>
let db = JSON.parse(localStorage.getItem("db")) || {
 school:"‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á",
 logo:"",
 students:{},
 teachers:{},
 subjects:{},
 attendance:[]
}

function save(){localStorage.setItem("db",JSON.stringify(db))}

function show(id){
["student","teacher","admin"].forEach(x=>document.getElementById(x).classList.add("hidden"))
document.getElementById(id).classList.remove("hidden")
}

document.getElementById("schoolName").innerText="üè´ "+db.school
document.getElementById("schoolLogo").src=db.logo

/* ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô */
function studentLogin(){
let id=stuId.value
let s=db.students[id]
if(!s){alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");return}
stuArea.innerHTML=`
<p>‡∏ä‡∏∑‡πà‡∏≠: ${s.name}</p>
<div id="qrcode"></div>
<h4>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h4>
<ul>${db.attendance.filter(a=>a.sid==id).map(a=>`<li>${a.sub} : ${a.status}</li>`).join("")}</ul>`
new QRCode(document.getElementById("qrcode"), id)
}

/* ‡∏Ñ‡∏£‡∏π */
function teacherLogin(){
let t=db.teachers[tUser.value]
if(!t||t.pass!=tPass.value){alert("‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");return}
teacherArea.innerHTML=`
<select id="sub">${Object.keys(db.subjects).map(s=>`<option>${s}</option>`)}</select>
<div id="reader" style="width:300px"></div>
<button onclick="startScan()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô</button>
<div id="result"></div>`
}

function startScan(){
let qr=new Html5Qrcode("reader")
qr.start({facingMode:"environment"},{fps:10},txt=>{
qr.stop()
let st=prompt("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏°‡∏≤ / ‡∏™‡∏≤‡∏¢ / ‡∏Ç‡∏≤‡∏î / ‡∏•‡∏≤‡∏Å‡∏¥‡∏à / ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢")
db.attendance.push({sid:txt,sub:sub.value,status:st})
save()
result.innerHTML="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß"
})
}

/* Admin */
function adminLogin(){
if(adminPass.value!="1669"){alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î");return}
adminArea.innerHTML=`
<h4>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
<input placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" onchange="db.school=this.value;save();location.reload()">
<input placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÇ‡∏•‡πÇ‡∏Å‡πâ" onchange="db.logo=this.value;save();location.reload()">

<h4>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
<input id="sid" placeholder="‡∏£‡∏´‡∏±‡∏™">
<input id="sname" placeholder="‡∏ä‡∏∑‡πà‡∏≠">
<button onclick="db.students[sid.value]={name:sname.value};save()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>

<h4>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏π</h4>
<input id="tname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π">
<input id="tpass" placeholder="‡∏£‡∏´‡∏±‡∏™">
<button onclick="db.teachers[tname.value]={pass:tpass.value};save()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>

<h4>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</h4>
<input id="subj">
<button onclick="db.subjects[subj.value]=true;save()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
`
}
</script>
</body>
</html>
