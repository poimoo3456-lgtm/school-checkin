<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ QR</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<style>
body{font-family:sans-serif;background:#eef2f5;padding:20px}
.box{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
button{padding:6px 12px;margin:5px}
input,select{padding:5px;margin:5px}
img{border-radius:10px}
.hidden{display:none}
</style>
</head>
<body>

<h2 id="schoolName">üè´ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
<img id="schoolLogo" height="60">

<div class="box">
<button onclick="show('student')">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
<button onclick="show('teacher')">‡∏Ñ‡∏£‡∏π</button>
<button onclick="show('admin')">‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</button>
</div>

<!-- ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
<div id="student" class="box hidden">
<h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
<input id="stuId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
<button onclick="studentLogin()">‡πÄ‡∏Ç‡πâ‡∏≤</button>
<div id="stuArea"></div>
</div>

<!-- ‡∏Ñ‡∏£‡∏π -->
<div id="teacher" class="box hidden">
<h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏π</h3>
<input id="tUser" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π">
<input id="tPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
<button onclick="teacherLogin()">‡πÄ‡∏Ç‡πâ‡∏≤</button>
<div id="teacherArea"></div>
</div>

<!-- Admin -->
<div id="admin" class="box hidden">
<h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h3>
<input id="adminPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
<button onclick="adminLogin()">‡πÄ‡∏Ç‡πâ‡∏≤</button>
<div id="adminArea"></div>
</div>

<script>
let db = JSON.parse(localStorage.getItem("db")) || {
 school:"‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á",
 logo:"",
 students:{},
 teachers:{},
 subjects:{},
 attendance:[]
}
function save(){localStorage.setItem("db",JSON.stringify(db))}

schoolName.innerText="üè´ "+db.school
schoolLogo.src=db.logo

function show(id){
["student","teacher","admin"].forEach(x=>document.getElementById(x).classList.add("hidden"))
document.getElementById(id).classList.remove("hidden")
}

/* ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô */
function studentLogin(){
let s=db.students[stuId.value]
if(!s){alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");return}
stuArea.innerHTML=`
<img src="${s.photo||''}" height="120"><br>
‡∏ä‡∏∑‡πà‡∏≠: ${s.name}<br>
‡∏ä‡∏±‡πâ‡∏ô: ‡∏°.${s.level}/${s.room}
<div id="qrcode"></div>
<h4>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h4>
<ul>
${db.attendance.filter(a=>a.sid==stuId.value)
.map(a=>`<li>${a.sub} | ‡∏°.${a.level}/${a.room} : ${a.status}</li>`).join("")}
</ul>`
new QRCode(document.getElementById("qrcode"), stuId.value)
}

/* ‡∏Ñ‡∏£‡∏π */
function teacherLogin(){
let t=db.teachers[tUser.value]
if(!t||t.pass!=tPass.value){alert("‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");return}

teacherArea.innerHTML=`
<select id="sub">${Object.keys(db.subjects).map(s=>`<option>${s}</option>`).join("")}</select>
<select id="level"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option></select>
<select id="room"><option>1</option><option>2</option><option>3</option><option>4</option></select>
<div id="reader" style="width:300px"></div>
<button onclick="startScan()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô</button>
<div id="result"></div>`
}

function startScan(){
let qr=new Html5Qrcode("reader")
qr.start({facingMode:"environment"},{fps:10},txt=>{
qr.stop()
let s=db.students[txt]
if(!s||s.level!=level.value||s.room!=room.value){alert("‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á");return}
let st=prompt("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏°‡∏≤ / ‡∏°‡∏≤‡∏™‡∏≤‡∏¢ / ‡∏Ç‡∏≤‡∏î / ‡∏•‡∏≤‡∏Å‡∏¥‡∏à / ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢")
db.attendance.push({sid:txt,sub:sub.value,level:level.value,room:room.value,status:st})
save()
result.innerHTML="‚úî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß"
})
}

/* Admin */
function adminLogin(){
if(adminPass.value!="1669"){alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î");return}

adminArea.innerHTML=`
<h4>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
<input placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" onchange="db.school=this.value;save();location.reload()">
<input placeholder="‡πÇ‡∏•‡πÇ‡∏Å‡πâ URL" onchange="db.logo=this.value;save();location.reload()">

<h4>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ)</h4>
<input id="sid" placeholder="‡∏£‡∏´‡∏±‡∏™">
<input id="sname" placeholder="‡∏ä‡∏∑‡πà‡∏≠">
<input id="slevel" placeholder="‡∏°.">
<input id="sroom" placeholder="‡∏´‡πâ‡∏≠‡∏á">
<input type="file" accept="image/*" capture="camera" onchange="loadPhoto(event)">
<br>
<img id="preview" height="120"><br>
<button onclick="addStudent()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>

<h4>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏π</h4>
<input id="tname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π">
<input id="tpass" placeholder="‡∏£‡∏´‡∏±‡∏™">
<button onclick="db.teachers[tname.value]={pass:tpass.value};save()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>

<h4>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</h4>
<input id="subj">
<button onclick="db.subjects[subj.value]=true;save()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
`
}

let photoData=""
function loadPhoto(e){
let reader=new FileReader()
reader.onload=()=>{photoData=reader.result;preview.src=photoData}
reader.readAsDataURL(e.target.files[0])
}

function addStudent(){
db.students[sid.value]={
name:sname.value,
level:slevel.value,
room:sroom.value,
photo:photoData
}
save()
alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")
}
</script>
</body>
</html>
